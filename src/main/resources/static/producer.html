<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Producer Mini-Site</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root {
            --bg: #0b1220;
            --card-bg: #ffffff;
            --muted: #6b7280;
            --border: #e5e7eb;
            --accent: #2563eb;
            --accent-soft: #dbeafe;
            --danger: #dc2626;
            --danger-soft: #fee2e2;
            --success: #16a34a;
            --success-soft: #dcfce7;
        }
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f3f4f6;
            color: #111827;
        }
        .top-bar {
            background: #020617;
            color: #e5e7eb;
            padding: 8px 16px;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .top-bar-left {
            font-weight: 600;
            letter-spacing: 0.03em;
            text-transform: uppercase;
            font-size: 10px;
        }
        .top-bar-right {
            display: flex;
            gap: 12px;
            align-items: center;
            font-size: 10px;
        }
        .top-pill {
            padding: 2px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.6);
            background: rgba(15, 23, 42, 0.7);
        }
        .top-pill span {
            color: #e5e7eb;
        }
        .shell {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }
        .main-header {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 16px;
            margin-bottom: 16px;
        }
        .project-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }
        .project-sub {
            margin: 4px 0 0;
            font-size: 13px;
            color: var(--muted);
        }
        .token-line {
            font-size: 11px;
            color: var(--muted);
            margin-top: 6px;
        }
        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            border-radius: 999px;
            padding: 3px 8px;
            border: 1px solid transparent;
            cursor: default;
        }
        .badge-pill {
            background: #0f172a;
            color: #e5e7eb;
            border-color: #1f2937;
        }
        .badge-soft {
            background: #eff6ff;
            color: #1d4ed8;
            border-color: #bfdbfe;
        }
        .badge-danger {
            background: var(--danger-soft);
            color: var(--danger);
            border-color: #fecaca;
        }
        .badge-success {
            background: var(--success-soft);
            color: var(--success);
            border-color: #bbf7d0;
        }
        .main-nav {
            display: flex;
            gap: 8px;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 16px;
        }
        .main-nav a {
            padding: 6px 12px;
            font-size: 13px;
            color: #4b5563;
            text-decoration: none;
            border-radius: 999px 999px 0 0;
            border: 1px solid transparent;
        }
        .main-nav a.active {
            background: #ffffff;
            border-color: #e5e7eb;
            border-bottom-color: #ffffff;
            color: #111827;
            font-weight: 500;
        }
        .card {
            background: #ffffff;
            border-radius: 14px;
            border: 1px solid #e5e7eb;
            padding: 16px 18px;
            box-shadow: 0 10px 25px rgba(15, 23, 42, 0.06);
        }
        .section {
            display: none;
            margin-bottom: 16px;
        }
        .section.active {
            display: block;
        }
        .section-title {
            font-size: 16px;
            font-weight: 600;
        }
        .section-sub {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }
        .split {
            display: grid;
            grid-template-columns: 1.3fr 1fr;
            gap: 16px;
            margin-top: 16px;
        }
        .sub-card-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
        }
        .sub-card-sub {
            font-size: 11px;
            color: var(--muted);
            margin-bottom: 10px;
        }
        .song-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .song-table th,
        .song-table td {
            border-bottom: 1px solid #e5e7eb;
            padding: 6px 8px;
        }
        .song-table th {
            text-align: left;
            font-weight: 600;
            background: #f9fafb;
        }
        .song-num {
            width: 50px;
            text-align: center;
            color: #6b7280;
        }
        .song-input {
            width: 100%;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #d1d5db;
            font-size: 12px;
        }
        .lock-btn {
            font-size: 11px;
            border-radius: 999px;
            padding: 3px 8px;
            cursor: pointer;
            border: 1px solid transparent;
            background: var(--danger-soft);
            color: var(--danger);
            border-color: #fecaca;
        }
        .lock-btn.locked {
            background: var(--success-soft);
            color: var(--success);
            border-color: #bbf7d0;
        }
        .hint {
            font-size: 11px;
            color: var(--muted);
            margin-top: 8px;
        }
        /* SONGS TAB */
        .songs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            margin-top: 8px;
        }
        .song-select {
            padding: 6px 10px;
            font-size: 13px;
            border-radius: 999px;
            border: 1px solid #d1d5db;
            background: #f9fafb;
        }
        .songs-meta-line {
            font-size: 12px;
            color: var(--muted);
            margin-top: 6px;
        }
        .song-worksheet-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            margin-top: 12px;
        }
        .song-worksheet-table th,
        .song-worksheet-table td {
            padding: 6px 8px;
            border-bottom: 1px solid #e5e7eb;
        }
        .song-worksheet-table th {
            background: #f9fafb;
            font-weight: 600;
        }
        .audio-cell {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        audio {
            width: 100%;
        }
        .timeline-wrapper {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
            color: #6b7280;
        }
        .timeline-range {
            flex: 1;
            -webkit-appearance: none;
            height: 4px;
            border-radius: 999px;
            background: #e5e7eb;
            outline: none;
            cursor: pointer;
        }
        .timeline-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #2563eb;
            margin-top: -4px;
        }
        .timeline-range::-moz-range-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #2563eb;
            border: none;
        }
        /* META TAB */
        .meta-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 14px;
        }
        .meta-card {
            background: #f9fafb;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            padding: 14px 16px;
        }
        .meta-col-title {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 10px;
        }
        .meta-field {
            margin-bottom: 10px;
        }
        .meta-field label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .meta-input[type="text"],
        .meta-input[type="date"],
        .meta-input[type="file"],
        .meta-input,
        textarea.meta-input {
            width: 100%;
            padding: 7px 8px;
            border-radius: 6px;
            border: 1px solid #d1d5db;
            font-size: 12px;
        }
        .meta-upload-note {
            font-size: 11px;
            color: #6b7280;
            margin-top: 4px;
        }
        .meta-lock-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 6px;
        }
        .link-btn {
            background: none;
            border: none;
            padding: 0;
            font-size: 12px;
            color: #2563eb;
            cursor: pointer;
        }
        .link-btn:hover {
            text-decoration: underline;
        }
        .meta-misc-remove {
            background: none;
            border: none;
            font-size: 11px;
            color: #dc2626;
            cursor: pointer;
            margin-top: 4px;
        }
        .meta-footer {
            margin-top: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .footer-note {
            font-size: 11px;
            color: #6b7280;
        }
        .btn-primary {
            border-radius: 999px;
            border: none;
            padding: 7px 14px;
            font-size: 12px;
            background: #111827;
            color: #f9fafb;
            cursor: pointer;
        }
        .btn-primary:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        /* FILES TAB BASIC */
        .files-list {
            font-size: 12px;
            color: #6b7280;
            margin-top: 10px;
        }
        .files-row {
            padding: 6px 0;
            border-bottom: 1px dashed #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .files-row span {
            font-size: 11px;
        }
        @media (max-width: 800px) {
            .split {
                grid-template-columns: 1fr;
            }
            .meta-layout {
                grid-template-columns: 1fr;
            }
            .main-header {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div class="top-bar">
    <div class="top-bar-left">PRODUCER MINI-SITE</div>
    <div class="top-bar-right">
        <div class="top-pill">
            <span id="tb-project">Project: —</span>
        </div>
        <div class="top-pill">
            <span id="tb-producer">Producer: —</span>
        </div>
        <div class="top-pill">
            <span id="tb-status">Status: Dev</span>
        </div>
    </div>
</div>

<div class="shell">
    <div class="main-header">
        <div>
            <h1 class="project-title" id="project-name">Untitled project</h1>
            <p class="project-sub" id="project-subline">
                Magic link producer view (dev). Song + bridge workflow in beta.
            </p>
            <div class="token-line">
                Token: <span id="token-display">—</span>
            </div>
        </div>
        <div style="text-align:right; font-size:11px; color:#6b7280;">
            <div>
                <span class="badge badge-soft">Internal dev</span>
            </div>
            <div style="margin-top:4px;">
                This view hides Dashboard & admin. For magic-link producers only.
            </div>
        </div>
    </div>

    <nav class="main-nav">
        <a href="#" data-section="home" class="active">Home</a>
        <a href="#" data-section="songs">Songs</a>
        <a href="#" data-section="meta">Meta</a>
        <a href="#" data-section="files">Files</a>
    </nav>

    <!-- HOME -->
    <div id="section-home" class="card section active">
        <div class="section-title">Home</div>
        <div class="section-sub">
            Quick overview and song naming. This drives the other tabs (Songs, Meta).
        </div>

        <div class="split">
            <div>
                <div class="sub-card-title">Section 2 — Song list</div>
                <div class="sub-card-sub">
                    Name each song here. Locks hold the name in place. Songs tab and Meta tab use these titles.
                </div>
                <table class="song-table" id="home-song-table">
                    <thead>
                    <tr>
                        <th>Song #</th>
                        <th>Title</th>
                        <th>Lock</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 1–9 rows -->
                    </tbody>
                </table>
                <div class="hint">
                    When you lock a title, we can treat it as “final name” and reflect it across the mini-site.
                </div>
            </div>

            <div>
                <div class="sub-card-title">Section 3 — Dev mix logic (reference only)</div>
                <div class="sub-card-sub">
                    Internal reference player. Songs tab uses the same ideas but per-bridge.
                </div>
                <div style="font-size:11px; color:#6b7280;">
                    This box is just placeholder text so we can adapt the mix logic in one place without blocking
                    the producer workflow.
                </div>
            </div>
        </div>
    </div>

    <!-- SONGS -->
    <div id="section-songs" class="card section">
        <div class="songs-header">
            <div>
                <div class="section-title">Song Pages</div>
                <div class="section-sub">
                    Pick a song from the dropdown. This page is a worksheet of bridges from that song to the others.
                </div>
                <div class="songs-meta-line" id="songs-meta-line">
                    Working on Song 1 — <span id="songs-meta-title">Untitled</span>
                </div>
            </div>
            <div>
                <select id="song-select" class="song-select">
                    <option value="1">Song 1</option>
                    <option value="2">Song 2</option>
                    <option value="3">Song 3</option>
                    <option value="4">Song 4</option>
                    <option value="5">Song 5</option>
                    <option value="6">Song 6</option>
                    <option value="7">Song 7</option>
                    <option value="8">Song 8</option>
                    <option value="9">Song 9</option>
                </select>
            </div>
        </div>

        <table class="song-worksheet-table" id="song-worksheet">
            <thead>
            <tr>
                <th>Song #</th>
                <th>From</th>
                <th>To</th>
                <th>Upload bridge</th>
                <th>Preview bridge</th>
                <th>Review mix</th>
                <th>Lock / Unlock</th>
            </tr>
            </thead>
            <tbody>
            <!-- JS builds rows -->
            </tbody>
        </table>

        <div class="hint">
            Preview bridge plays the bridge file only. Review mix uses the same file as a placeholder mix and shows a time bar.
            Later, backend will feed actual song+bridge+song audio.
        </div>
    </div>

    <!-- META -->
    <div id="section-meta" class="card section">
        <div class="section-title">Meta</div>
        <div class="section-sub">
            Album details, artwork, extras and per-song credits. (UI only, no backend save yet.)
        </div>

        <div class="meta-layout">
            <!-- LEFT: album info -->
            <div class="meta-card">
                <div class="meta-col-title">Album info</div>

                <div class="meta-field">
                    <label for="meta-album-name">Name of Album</label>
                    <input id="meta-album-name" type="text" class="meta-input" placeholder="Album title">
                </div>

                <div class="meta-field">
                    <label for="meta-artist-name">Artist name</label>
                    <input id="meta-artist-name" type="text" class="meta-input" placeholder="Artist">
                </div>

                <div class="meta-field">
                    <label for="meta-genre">Genre</label>
                    <input id="meta-genre" type="text" class="meta-input" placeholder="Genre">
                </div>

                <div class="meta-field">
                    <label for="meta-date">Date</label>
                    <input id="meta-date" type="date" class="meta-input">
                </div>
            </div>

            <!-- RIGHT: files -->
            <div class="meta-card">
                <div class="meta-col-title">Files</div>

                <div class="meta-field">
                    <label for="meta-artwork">Artwork +</label>
                    <input id="meta-artwork" type="file" class="meta-input" accept="image/*">
                    <p class="meta-upload-note">
                        Used on project pages and fan-facing assets.
                    </p>
                    <div class="meta-lock-row">
                        <span class="meta-upload-note">Lock / Unlock</span>
                        <button type="button"
                                class="badge badge-danger meta-lock"
                                data-meta-scope="album-art">
                            Unlocked
                        </button>
                    </div>
                </div>

                <hr>

                <div id="meta-misc-list">
                    <div class="meta-field meta-misc-row">
                        <label>Misc +</label>
                        <input type="file" class="meta-input"
                               accept="application/pdf,audio/*,image/*,video/*">
                        <p class="meta-upload-note">
                            Use for PDFs, stems, lyric sheets or extra fan files.
                        </p>
                        <button type="button" class="meta-misc-remove">Remove</button>
                    </div>
                </div>

                <button type="button" id="meta-misc-add" class="link-btn">
                    + Add misc file
                </button>

                <div class="meta-lock-row" style="margin-top:12px;">
                    <span class="meta-upload-note">Lock / Unlock</span>
                    <button type="button"
                            class="badge badge-danger meta-lock"
                            data-meta-scope="album-misc">
                        Unlocked
                    </button>
                </div>
            </div>
        </div>

        <div class="meta-footer">
            <button type="button" id="meta-save-btn" class="btn-primary" disabled>
                Save Meta (dev only)
            </button>
            <div class="footer-note">
                Dev mode: later this will push album + song meta to the project page and SaaS.
            </div>
        </div>
    </div>

    <!-- FILES -->
    <div id="section-files" class="card section">
        <div class="section-title">Files</div>
        <div class="section-sub">
            This is just a placeholder summary for stored files (later pulled from backend).
        </div>

        <div class="files-list">
            <div class="files-row">
                <span>Song files (1–9)</span>
                <span>Preview only in this beta.</span>
            </div>
            <div class="files-row">
                <span>Bridge files (per song → song)</span>
                <span>Used by the Songs tab’s preview/mix rows.</span>
            </div>
            <div class="files-row">
                <span>Artwork + misc</span>
                <span>From the Meta tab.</span>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
(function() {
    // ---- NAV ----
    function activateSection(name) {
        $(".main-nav a[data-section]").removeClass("active");
        $('.main-nav a[data-section="' + name + '"]').addClass("active");
        $(".section").removeClass("active");
        $("#section-" + name).addClass("active");
    }
    $(".main-nav a[data-section]").on("click", function(e) {
        e.preventDefault();
        activateSection($(this).data("section"));
    });

    // ---- MAGIC LINK + PROJECT HEADER ----
    var hash = window.location.hash || "";
    var token = hash.replace(/^#/, "").trim();

    if (!token) {
        $("#token-display").text("—");
        $("#tb-status").text("Status: Dev mode (no token)");
        $("#project-name").text("Dev project (no token)");
    } else {
        $("#token-display").text(token);
        $.ajax({
            url: "/api/project-by-token/" + encodeURIComponent(token),
            method: "GET",
            success: function(data) {
                if (!data) {
                    $("#tb-status").text("Status: Token not found");
                    return;
                }
                var projectName = data.projectName || "Untitled project";
                var producerName = data.producerName || "—";
                var projectId = data.id || "—";

                $("#project-name").text(projectName);
                $("#project-subline").text("Magic link producer view for " + projectName);
                $("#tb-project").text("Project: " + projectId);
                $("#tb-producer").text("Producer: " + producerName);
                $("#tb-status").text("Status: Magic link active");
            },
            error: function() {
                $("#tb-status").text("Status: Dev mode (fetch error)");
            }
        });
    }

    // ---- HOME SONG TABLE (Section 2) ----
    var songTitles = {};  // { 1: "Title", 2: "..." }

    function buildHomeSongTable() {
        var $tbody = $("#home-song-table tbody");
        $tbody.empty();
        for (var i = 1; i <= 9; i++) {
            var currentTitle = songTitles[i] || "";
            var row = [
                '<tr data-song-num="' + i + '">',
                '  <td class="song-num">Song ' + i + '</td>',
                '  <td><input type="text" class="song-input" value="' + currentTitle.replace(/"/g, '&quot;') + '"></td>',
                '  <td><button type="button" class="lock-btn">Unlocked</button></td>',
                '</tr>'
            ].join("");
            $tbody.append(row);
        }
    }
    buildHomeSongTable();

    $("#home-song-table").on("input", ".song-input", function() {
        var row = $(this).closest("tr");
        var num = parseInt(row.data("song-num"), 10);
        songTitles[num] = $(this).val().trim();
        refreshSongsHeader();
    });

    $("#home-song-table").on("click", ".lock-btn", function() {
        var $btn = $(this);
        $btn.toggleClass("locked");
        if ($btn.hasClass("locked")) {
            $btn.text("Locked");
        } else {
            $btn.text("Unlocked");
        }
    });

    function refreshSongsHeader() {
        var current = parseInt($("#song-select").val(), 10);
        var title = songTitles[current] || "Untitled";
        $("#songs-meta-title").text(title);
        $("#songs-meta-line").html("Working on Song " + current + " — <span>" + title + "</span>");
    }

    // ---- SONGS WORKSHEET ----
    function buildSongWorksheet(fromSong) {
        var $tbody = $("#song-worksheet tbody");
        $tbody.empty();
        for (var toSong = 1; toSong <= 9; toSong++) {
            if (toSong === fromSong) continue;
            var fromTitle = songTitles[fromSong] || ("Song " + fromSong);
            var toTitle = songTitles[toSong] || ("Song " + toSong);

            var rowHtml = [
                '<tr data-from-song="' + fromSong + '" data-to-song="' + toSong + '">',
                '  <td class="song-num">Song ' + fromSong + '</td>',
                '  <td>' + fromTitle + '</td>',
                '  <td>' + fromTitle + ' → ' + toTitle + '</td>',
                '  <td><input type="file" class="bridge-file" accept="audio/*"></td>',
                '  <td class="audio-cell">',
                '    <audio class="bridge-audio" controls></audio>',
                '  </td>',
                '  <td class="audio-cell">',
                '    <audio class="mix-audio" controls></audio>',
                '    <div class="timeline-wrapper">',
                '      <span class="time-label current">0:00</span>',
                '      <input type="range" min="0" max="100" value="0" class="timeline-range">',
                '      <span class="time-label total">0:00</span>',
                '    </div>',
                '  </td>',
                '  <td>',
                '    <button type="button" class="lock-btn">Unlocked</button>',
                '  </td>',
                '</tr>'
            ].join("");
            $tbody.append(rowHtml);
        }
    }

    $("#song-select").on("change", function() {
        var val = parseInt($(this).val(), 10);
        buildSongWorksheet(val);
        refreshSongsHeader();
    });

    // initialize for Song 1
    buildSongWorksheet(1);
    refreshSongsHeader();

    // When a bridge file is chosen, feed both preview + mix audio
    $("#song-worksheet").on("change", ".bridge-file", function() {
        var file = this.files && this.files[0];
        var $row = $(this).closest("tr");
        var $bridgeAudio = $row.find(".bridge-audio");
        var $mixAudio = $row.find(".mix-audio");
        if (file) {
            var url = URL.createObjectURL(file);
            $bridgeAudio.attr("src", url);
            $mixAudio.attr("src", url); // placeholder: same audio acts as "mix"
        } else {
            $bridgeAudio.removeAttr("src");
            $mixAudio.removeAttr("src");
        }
    });

    // Lock behavior on Songs worksheet
    $("#song-worksheet").on("click", ".lock-btn", function() {
        var $btn = $(this);
        $btn.toggleClass("locked");
        var $row = $btn.closest("tr");
        var locked = $btn.hasClass("locked");
        var text = locked ? "Locked" : "Unlocked";
        $btn.text(text);

        // disable or enable inputs & audio
        $row.find("input[type='file']").prop("disabled", locked);
        $row.find("audio").prop("controls", !locked);
        $row.find(".timeline-range").prop("disabled", locked);
    });

    // Timeline logic for mix player
    function formatTime(sec) {
        sec = Math.floor(sec || 0);
        var m = Math.floor(sec / 60);
        var s = sec % 60;
        return m + ":" + (s < 10 ? "0" + s : s);
    }

    $("#song-worksheet").on("loadedmetadata", ".mix-audio", function() {
        var audio = this;
        var $row = $(audio).closest("tr");
        var $total = $row.find(".time-label.total");
        var $range = $row.find(".timeline-range");
        if (audio.duration && isFinite(audio.duration)) {
            $total.text(formatTime(audio.duration));
        } else {
            $total.text("0:00");
        }
        $range.val(0);
        $row.find(".time-label.current").text("0:00");
    });

    $("#song-worksheet").on("timeupdate", ".mix-audio", function() {
        var audio = this;
        var $row = $(audio).closest("tr");
        var $range = $row.find(".timeline-range");
        var $current = $row.find(".time-label.current");
        if (audio.duration && isFinite(audio.duration)) {
            var val = (audio.currentTime / audio.duration) * 100;
            $range.val(val);
            $current.text(formatTime(audio.currentTime));
        }
    });

    // Dragging the timeline scrubs the audio
    $("#song-worksheet").on("input", ".timeline-range", function() {
        var $range = $(this);
        var $row = $range.closest("tr");
        var audio = $row.find(".mix-audio").get(0);
        if (!audio || !audio.duration || !isFinite(audio.duration)) return;
        var pct = parseFloat($range.val() || "0");
        var newTime = (pct / 100) * audio.duration;
        audio.currentTime = newTime;
        $row.find(".time-label.current").text(formatTime(newTime));
    });

    // ---- META TAB BEHAVIOR (misc add/remove + lock badges) ----
    $("#meta-misc-add").on("click", function() {
        var row = [
            '<div class="meta-field meta-misc-row">',
            '  <label>Misc +</label>',
            '  <input type="file" class="meta-input" accept="application/pdf,audio/*,image/*,video/*">',
            '  <p class="meta-upload-note">Use for PDFs, stems, lyric sheets or extra fan files.</p>',
            '  <button type="button" class="meta-misc-remove">Remove</button>',
            '</div>'
        ].join("");
        $("#meta-misc-list").append(row);
    });

    $("#meta-misc-list").on("click", ".meta-misc-remove", function() {
        $(this).closest(".meta-misc-row").remove();
    });

    $(".meta-card").on("click", ".meta-lock", function() {
        var $btn = $(this);
        if ($btn.hasClass("badge-danger")) {
            $btn.removeClass("badge-danger").addClass("badge-success").text("Locked");
        } else {
            $btn.removeClass("badge-success").addClass("badge-danger").text("Unlocked");
        }
    });
})();
</script>
</body>
</html>

o

